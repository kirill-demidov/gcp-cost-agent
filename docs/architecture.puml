@startuml
!theme plain
title GCP Cost Agent System Architecture

actor User
participant Frontend as Frontend
participant Backend as Backend
participant Toolbox as Toolbox
participant BigQuery as BigQuery
participant CloudRun as CloudRun

== Local Development Flow ==

User -> Frontend: Ask cost question
Frontend -> Backend: POST /chat
Backend -> Backend: Parse intent with LLM
Backend -> Toolbox: Call MCP tool
Toolbox -> BigQuery: Execute SQL query
BigQuery -> Toolbox: Return billing data
Toolbox -> Backend: Structured response
Backend -> Backend: Process and format data
Backend -> Frontend: JSON response
Frontend -> User: Display formatted results

== Cloud Run Deployment Flow ==

note over CloudRun: Containerized deployment
User -> CloudRun: HTTP request
CloudRun -> Backend: Route to FastAPI
Backend -> Toolbox: Call MCP tools
Toolbox -> BigQuery: Query billing data
BigQuery -> Toolbox: Return results
Toolbox -> Backend: Processed data
Backend -> CloudRun: Response
CloudRun -> User: HTTP response

== Advanced Analytics Flow ==

User -> Frontend: Complex query about anomalies
Frontend -> Backend: POST /chat
Backend -> Backend: LLM intent analysis
Backend -> Toolbox: Multiple tool calls
Toolbox -> BigQuery: Complex SQL queries
BigQuery -> Toolbox: Historical data
Toolbox -> Backend: Analytics results
Backend -> Backend: Generate insights with LLM
Backend -> Frontend: Detailed analysis
Frontend -> User: Visualized results

== Error Handling Flow ==

User -> Frontend: Invalid query
Frontend -> Backend: POST /chat
Backend -> Backend: Intent recognition
Backend -> Frontend: Error message
Frontend -> User: Helpful error message

@enduml