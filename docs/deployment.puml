@startuml
!theme plain
title GCP Cost Agent - Deployment Process

actor Developer
participant "Local Machine" as Local
participant "Cloud Build" as Build
participant "Container Registry" as Registry
participant "Cloud Run" as Run
participant "BigQuery" as BQ

== Build and Deploy Process ==

Developer -> Local: Set environment variables
Developer -> Local: Run deploy.sh

Local -> Local: Validate environment
Local -> Local: Build Docker image locally

Local -> Build: Submit build with source code
Build -> Build: Install dependencies
Build -> Build: Copy application files
Build -> Build: Configure environment variables
Build -> Build: Create Docker image

Build -> Registry: Push image to Container Registry

Registry -> Run: Deploy to Cloud Run
Run -> Run: Configure service
Run -> Run: Set environment variables

Run -> BQ: Health check to verify BigQuery access
BQ -> Run: Connection confirmed

Run -> Developer: Service deployed with URL

== Runtime Flow ==

note over Run: Container running on Cloud Run
Developer -> Run: HTTP request to /health
Run -> Developer: Health status response

Developer -> Run: POST /chat with cost question
Run -> Run: Process request in container
Run -> BQ: Query billing data
BQ -> Run: Return results
Run -> Developer: Formatted response

== Scaling ==

note over Run: Auto-scaling based on traffic
Developer -> Run: Multiple concurrent requests
Run -> Run: Scale up instances
Run -> Developer: Handle increased load

note over Run: Scale down when idle
Run -> Run: Reduce to min instances

@enduml